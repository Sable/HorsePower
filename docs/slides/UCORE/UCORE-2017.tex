\documentclass[sigplan]{acmart}

% remove ACM copyright blocks (found at: http://goo.gl/6zcKds)
\settopmatter{printacmref=false}
\renewcommand\footnotetextcopyrightpermission[1]{}
\pagestyle{plain}

\begin{document}
\title{HorseIR : An Array-based Approach to SQL Queries}

\author{Hongji Chen}
\affiliation{
    \institution{McGill University}
    \city{Montreal}
    \state{Quebec}
    \country{Canada}
}
\email{hongji.chen@mail.mcgill.ca}

\author{Hanfeng Chen}
\affiliation{
    \institution{McGill University}
    \city{Montreal}
    \state{Quebec}
    \country{Canada}
}
\email{hanfeng.chen@mail.mcgill.ca}

\author{Laurie Hendren}
\affiliation{
    \institution{McGill University}
    \city{Montreal}
    \state{Quebec}
    \country{Canada}
}
\email{hendren@cs.mcgill.ca}

\maketitle

\section{Problem and Motivation}

Modern software services, such as financial analysis, operate on a vast amount
of data. To address the challenge of data querying, the design of the database
systems and query languages continuously evolve during the past decade.
Database systems, such as MonetDB\cite{MonetDBHome}, utilize the
IR-based analysis and optimization techniques to meet the performance
challenges and introduce user-defined functions (UDFs) to extend the
flexibility of the SQL standard.  However, the conventional IR design hides the
details of database querying steps (such as joining) or separates the IR with
user-defined functions. These drawbacks significantly limit the context
information propagated to the backend and render the optimizer less effective. 

In this project, we purpose an array-based IR, named HorseIR, which explores the
details of query fully and connects to user-defined functions transparently. By
replacing SQL and user-defined functions with built-in array-based primitives, HorseIR will
enable the optimizer in back-end to employ techniques developed in programming language
research field such as data-flow analysis, in the hope of handling more
flexible queries efficiently. 

\section{Background and Related Work}

MonetDB is one of the pioneers in IR based execution engine design
\cite{DBLP:journals/debu/IdreosGNMMK12}. Upon receiving a SQL query, its
front-end compiles the query into a sequence of intermediate representation
codes called MonetDB Assembly Language (MAL), with each instruction mapping to
a built-in relational algebra primitive operation. The execution kernel later
interprets the instructions step by step and generates the query result.

In 1993, Arthur Whitney launched the K programming language
\cite{KLangTutorial} , as a foundation for KDB system. After ten years of
development, K programming language evolves into Q programming language
\cite{QLangTutorial} which provides a more readable interface. Both languages
adopt the idea of array programming; hence they can be easily parallelized
using SIMD or MIMD during execution \cite{HowFastCanAPLBe}. 


\section{Approach and Uniqueness}

The state of the art architecture of MonetDB kernel inspires the design of
HorseIR. Similar to MonetDB, we introduce an intermediate representation, to
handle the complexity of SQL query interpretation.  However, unlike MonetDB,
the syntax and primitives follow the array programming style. HorseIR is a
static single assigned (SSA) statically typed array programming language. It
implements most of the primitives in array programming and database-specific
data types introduced in K and Q programming languages.

\section{Results and Contributions}

During the summer we have implemented both the front-end and back-end of
HorseIR. Comparing with the traditional approaches  SQL queries, HorseIR has
the following advantages,

\paragraph{Array-based IR with Rich Set of Built-in Primitives}
In MonetDB, each primitive captures the operation in relational algebra.
Although this simplifies the design of the execution engine, it hides the
details from the optimizer. Thus in HorseIR, we expose such information to the
back-end by introducing an array-based IR. The primitives in HorseIR are basic
array-based arithmetic (e.g. factorial) or database-specific operations (e.g. table loading).
Thus we can replace each relational operation with one or more
array-based primitives. 

\paragraph{Programming Language Optimization for Database}
In the traditional approach, the optimizations for database queries focused
on relational algebra and execution plan level. Thus, in MonetDB and many other
database systems, minimal optimizations are applied on the intermediate
representation level. By introducing array-based HorseIR, we introduce the
techniques developed in programming language research field to the database
query processing.

\paragraph{Extensible Framework for User-defined Functions (UDF)}
There is no specification for user-defined functions in SQL standard. However,
to improve the flexibility of the SQL queries, many database systems have
introduced UDF as a language extension. However, the implementation and
optimization for UDF introduce complexity in system design. The traditional
approach UDF is either reduce the language flexibility (used in MonetDB, all
UDF are implemented using hand-written MAL \cite{MALUDF}) or require external
linkage \cite{ExternUDF}. Our solution is to compile the UDF written in an
arbitrary language into HorseIR and later compile the generated intermediate
code with the SQL queries. HorseIR allows flexible UDF implementation and
efficient code generation. Further, we can apply compiler optimization techniques to optimize
the UDF, such as function inlining.

\paragraph{Efficient Parallel Code Generation}
Recent research attempted to introduce parallel computation into database
queries using both CPU\cite{DBLP:conf/sigmod/PolychroniouRR15, DBLP:conf/sigmod/ZhouR02} and GPU \cite{DBLP:conf/ica3pp/CremerBMM16}.
These research shows that the performance of database query is improved
significantly using the parallel physical architecture. As HorseIR is an
array-based programming language, it is easy to parallelize array-based primitives
\cite{DBLP:conf/pldi/ImamSLK14}.

\section{Conclusion and Future Work}

In this project, we purpose a new intermediate representation on SQL database
queries. The IR provide the queries with high-performance implementation and
flexible extension. The new system would enable high-performance in-memory data
access, that is essential to many software applications. The project also provides
a new aspect in database query optimization research by employing programming
language techniques. 

Currently, we have completed the implementation of front-end and back-end. In
the future, we will integrate static analyses and an optimization framework into
the front-end, and add parallel implementation to the back-end, which will
further improve the performance of the current system. 

\bibliographystyle{ACM-Reference-Format}
\bibliography{UCORE-2017}
\end{document}
